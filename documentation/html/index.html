<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>far-mar-onboard-firmware: Lady Elizabeth OBC firmware Documentation.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">far-mar-onboard-firmware
   </div>
   <div id="projectbrief">Onboard data acquition for the Lady Elizabeth rocket.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Lady Elizabeth OBC firmware Documentation. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This manual describes the operation of the firmware running on the Lady Elizabeth rocket.</p>
<h1><a class="anchor" id="mainpageIntroduction"></a>
Introduction</h1>
<p>The primary tasks for the onboard computer are:</p><ol type="1">
<li>Read data from the following sensors:<ul>
<li>Methane, Liquid Oxygen, Helium, Chamber, and Helium Regulator pressure transducers</li>
<li>Upper air frame type K thermocouple</li>
<li>Methane and Liquid Oxygen vent valve hall effect sensors</li>
<li>BNO055 Internal Measurement Unit</li>
</ul>
</li>
<li>Send the above sensor data to the off board data acquisition computer prior to launch</li>
<li>Log the above sensor data to an SD card inserted into the onboard computer.</li>
</ol>
<p>This firmware is created in Atmel Studio 7.0.</p>
<p>This documentation assumes basic familiarity with the FreeRTOS kernel. For learning basic concepts of the FreeRTOS kernel refer to the pdf book, "Mastering the FreeRTOS Real Time Kernel", at the <a href="https://www.freertos.org/Documentation/RTOS_book.html">FreeRTOS website</a>. For the sake of understanding the basics of this firmware you should read the sections Preface, Task Management, and Queue Management.</p>
<p>If you are unfamiliar with embedded firmware development or multi threading concepts you should also look at the <a class="el" href="concepts_page.html">Other useful concepts page</a>.</p>
<p>The current version of the onboard computer schematic can be found at <a href="https://github.com/SDSURocketProject/far-mars-avionics-pcb/blob/master/documentation/schematic.pdf">far-mars-avionics-pcb</a>.</p>
<h1><a class="anchor" id="mainpageAcronyms"></a>
Acronyms</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Acronym  </th><th class="markdownTableHeadLeft">Meaning   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ADC  </td><td class="markdownTableBodyLeft">Analog to Digital Converter   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ASF  </td><td class="markdownTableBodyLeft">Atmel Software Framework   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CH4  </td><td class="markdownTableBodyLeft">Methane   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DAQ  </td><td class="markdownTableBodyLeft">Data Acquisition   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">FMOF  </td><td class="markdownTableBodyLeft">Far Mars Onboard Firmware   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">HE  </td><td class="markdownTableBodyLeft">Helium   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">I2C  </td><td class="markdownTableBodyLeft">Inter-Integrated Circuit (pronounced I-squared-C)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">IMU  </td><td class="markdownTableBodyLeft">Internal Measurement Unit   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ISR  </td><td class="markdownTableBodyLeft">Interrupt Service Routine   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">LED  </td><td class="markdownTableBodyLeft">Light Emitting Diode   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">LiPo  </td><td class="markdownTableBodyLeft">Lithium Polymer Battery   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">LOX  </td><td class="markdownTableBodyLeft">Liquid Oxygen   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">OBC  </td><td class="markdownTableBodyLeft">Onboard Computer   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PSIG  </td><td class="markdownTableBodyLeft">Pressure per Square Inch Guage   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PSIA  </td><td class="markdownTableBodyLeft">Pressure per Square Inch Absolute   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PT  </td><td class="markdownTableBodyLeft">Pressure Transducer   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RTC  </td><td class="markdownTableBodyLeft">Real Time Clock   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">RTOS  </td><td class="markdownTableBodyLeft">Real Time Operating System   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RS485  </td><td class="markdownTableBodyLeft"><a href="https://en.wikipedia.org/wiki/RS-485">See Wikipedia</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SDADC  </td><td class="markdownTableBodyLeft">Sigma Delta Analog to Digital Converter   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SERCOM  </td><td class="markdownTableBodyLeft">Serial Communication Interface   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI  </td><td class="markdownTableBodyLeft">Serial Peripheral Interface   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">TC  </td><td class="markdownTableBodyLeft">Thermocouple   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">UAF  </td><td class="markdownTableBodyLeft">Upper Air Frame   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">UART  </td><td class="markdownTableBodyLeft">Universal Asynchronous Receiver-Transmitter   </td></tr>
</table>
<h1><a class="anchor" id="mainpageToO"></a>
Theory of Operation</h1>
<p>The OBC firmware is broken up into five distinct sections:</p><ul>
<li><a class="el" href="group___a__main_group.html">Initialization</a>: Initialization of the FreeRTOS kernel, tasks, and peripherals</li>
<li><a class="el" href="group___b__navigation_group.html">Navigation</a>: Read data from sensors aboard the rocket</li>
<li><a class="el" href="group___c__daq_group.html">Data Acquisition</a>: Transmit data to data acquisition computer</li>
<li><a class="el" href="group___d__logger_group.html">Logging</a>: Log data to SD card</li>
<li><a class="el" href="group___e__status_group.html">Status Indication</a>: Control LEDs to indicate OBC status</li>
</ul>
<p>The sections Navigation, Data Acquisition, Logging, and Status Indication can each be created as a FreeRTOS task, each with its own priority. Using these tasks and priorities the FreeRTOS kernel can switch between each task enabling us to write each task independent of each other. Because each task can be stopped and started by the FreeRTOS kernel at any time, communication must be done via a "thread safe" data structure. This firmware primarily uses FIFO queues for communication between tasks however mutexes are used on occasion.</p>
<p>Each task is listed below in order from highest priority to lowest:</p><ol type="1">
<li>Navigation</li>
<li>Data Acquisition</li>
<li>Logging</li>
<li>Status Indication</li>
</ol>
<p>The highest priority task in this firmware is the Navigation task because every other task depends on the Navigation task running on time, data can't be sent or logged if it hasn't yet been read from the sensors. The second highest priority task is the Data Acquisition task because this is how we know the current status of the rocket prior to launch. Failure to run this task could result in failure of the rocket if pressure tanks become overpressurized and we aren't aware of that in the bunker. The third highest priority task is the Logging task because if this task is unable to run on time it does not result in the failure of the rocket. Lastly the lowest priority task is the Status Indication because it should only update when everything else is working properly, failure of this task to update is is a clear indicator that the OBC is not working properly. Sometimes this task is set to the same priority as the Logging task because the status will not be updated if there is no SD card plugged in, setting the two tasks to the same priority fixes this if that is preferred.</p>
<h1><a class="anchor" id="mainpageDocGen"></a>
Documentation generation</h1>
<p>This section goes over the use of Doxygen for generating this documentation. Use of Doxygen is not necessary for learning/using the firmware in this documentation, however it is necessary for updating this documentation if you contribute to this firmware.</p>
<p>The latest version of Doxygen can be download from the <a href="http://doxygen.nl/download.html">Doxygen website</a>. Follow these steps to compile this documentation:</p><ol type="1">
<li>Open this projects Doxygen file by selecting "File &gt; Open" and selecting the "Doxyfile" at the root directory of this project</li>
<li>Select the "Run" tab and click the button labeled "Run Doxygen"</li>
<li>The output window will display the text "Doxygen has finished" when the documentation is finished compiling</li>
<li>You can view the documentation by clicking the "Show HTML output" button at the bottom of the wizard or by opening the file ".\documentation\html\index.html" in any web browser.</li>
</ol>
<p>For information on how to write documentation with Doxygen reference the <a href="http://doxygen.nl/manual/index.html">Doxygen manual</a>.</p>
<h1><a class="anchor" id="Todo"></a>
Todo</h1>
<h2><a class="anchor" id="todoCodeSec"></a>
Code related</h2>
<ul>
<li>Reorder the start conversion functions in <a class="el" href="navigation_8c.html">navigation.c</a> to be in order from longest to complete to shortest and put the read conversion functions in the reverse order.</li>
<li>Resize the daqSendTask stack size as it now only needs the size configMINIMAL_STACK_SIZE since commit 83bfc0186443a0f60d4229764ae8075fbaf678fa</li>
</ul>
<h2><a class="anchor" id="todoDocSec"></a>
Documentation related</h2>
<ul>
<li>Redo the "Interrupt Service Routines" and "callback vs polled" sections on the <a class="el" href="concepts_page.html">Other useful concepts</a> page</li>
<li>Complete the documentation for the B_navigationGroup, C_daqGroup, D_loggerGroup, and E_statusGroup groups.</li>
</ul>
<h1><a class="anchor" id="mainpageBNO055License"></a>
BNO055 License</h1>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
<p>Neither the name of the copyright holder nor the names of the contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE</p>
<p>The information provided is believed to be accurate and reliable. The copyright holder assumes no responsibility for the consequences of use of such information nor for any infringement of patents or other rights of third parties which may result from its use. No license is granted by implication or otherwise under any patent or patent rights of the copyright holder. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
